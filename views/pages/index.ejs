<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
    <script src="http://underscorejs.org/underscore-min.js"></script>
    <script src="http://cdn.mlkcca.com/v2.0.0/milkcocoa.js"></script>
    <title>1</title>
</head>
<body>
    <button id="send_button1">send1</button>
    <div style="margin-bottom: 30px;">この下にIDが表示される</div>
    <div  style="color:red;" id="message"></div>


    <%# START %>
      <ul class="memberList" id="list">
        <li>
          <span>ID</span>
          <span>苗字</span>
          <span>氏名</span>
          <span>帰り方</span>
        </li>
        <%# ループ --- //%>
        <%#// --- ループ %>
      </ul>
      <ul class="totalValue">
          <li>
            <%# ループ --- //%>
            <%#// --- ループ %>
          </li>
          <li>
            <span>合計人数</span>
              <span id="total"></span>
          </li>
      </ul>
    <%# //- END %>
<script>
    var milkcocoa = new MilkCocoa('flagiodjdk8y.mlkcca.com');
    var ds = milkcocoa.dataStore('messages');
    var total = 0;
  (function($){
      $('#send_button1').on('click', function() {
          ds.push({time : Date.now()});
      });

      ds.stream().next(function(err, list) {
          _.each(list, function(data) {
              if (!data.value) return;
              var v = data.value;
              if (!v.ID) return;
              $('#list').append('<li><span>'+(total+1)+'</span> <span>'+ v.ID + '</span> <span>'+ v.first + '</span> <span>'+ v.last + '</span></li>');
              ++total;
          });
          $('#total').text(total);

      });

      ds.on('push', function(data) {
          $('#message').text(JSON.stringify(data));
          if (!data.value) return;
          var v = data.value;
          if (!v.ID) return;
          $('#list').append('<li><span>'+(total+1)+'</span> <span>'+ v.ID + '</span> <span>'+ v.first + '</span> <span>'+ v.last + '</span></li>');
          ++total;
          $('#total').text(total);
      });
  })(jQuery);
</script>
</body>
</html>